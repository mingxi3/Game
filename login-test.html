<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .result {
            background: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç™»å½•æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-section">
        <h3>1. æ£€æŸ¥æœ¬åœ°å­˜å‚¨</h3>
        <button class="btn" onclick="checkStorage()">æ£€æŸ¥å­˜å‚¨æ•°æ®</button>
        <div id="storage-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>2. åˆ›å»ºæµ‹è¯•ç”¨æˆ·</h3>
        <button class="btn" onclick="createTestUser()">åˆ›å»ºæµ‹è¯•ç”¨æˆ·</button>
        <button class="btn" onclick="clearTestData()">æ¸…é™¤æµ‹è¯•æ•°æ®</button>
        <div id="create-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>3. æµ‹è¯•ç™»å½•çŠ¶æ€</h3>
        <button class="btn" onclick="testLoginStatus()">æµ‹è¯•ç™»å½•æ£€æŸ¥</button>
        <div id="login-result" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>4. æµ‹è¯•é€€å‡ºç™»å½•</h3>
        <button class="btn" onclick="testLogout()">æµ‹è¯•é€€å‡ºç™»å½•</button>
        <div id="logout-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>5. å¿«é€Ÿæ“ä½œ</h3>
        <a href="auth.html" class="btn">å‰å¾€ç™»å½•é¡µ</a>
        <a href="profile.html" class="btn">å‰å¾€ä¸ªäººä¸­å¿ƒ</a>
    </div>

    <script>
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„å‡½æ•°
        function checkStorage() {
            const result = document.getElementById('storage-result');
            try {
                const currentUser = localStorage.getItem('currentUser');
                const loggedInUser = localStorage.getItem('gameforge_logged_in_user');
                const users = localStorage.getItem('users');
                const gameforgeUsers = localStorage.getItem('gameforge_users');
                
                let html = '<strong>å­˜å‚¨æ•°æ®æ£€æŸ¥ç»“æœï¼š</strong><br>';
                html += `currentUser: ${currentUser || 'null'}<br>`;
                html += `gameforge_logged_in_user: ${loggedInUser || 'null'}<br>`;
                html += `usersæ•°é‡: ${users ? JSON.parse(users).length : 0}<br>`;
                html += `gameforge_usersæ•°é‡: ${gameforgeUsers ? JSON.parse(gameforgeUsers).length : 0}<br>`;
                
                result.innerHTML = html;
                result.className = 'result';
            } catch (error) {
                result.innerHTML = 'æ£€æŸ¥å‡ºé”™: ' + error.message;
                result.className = 'result error';
            }
        }
        
        // åˆ›å»ºæµ‹è¯•ç”¨æˆ·çš„å‡½æ•°
        function createTestUser() {
            const result = document.getElementById('create-result');
            try {
                // åˆ›å»ºæµ‹è¯•ç”¨æˆ·æ•°æ®
                const testUser = {
                    id: 999999,
                    username: 'testuser',
                    email: 'test@example.com',
                    password: '123456',
                    role: 'player',
                    joinDate: new Date().toISOString(),
                    downloadedGames: [1, 2, 3],
                    uploadedGames: []
                };
                
                // æ·»åŠ åˆ°ä¸¤ç§ç”¨æˆ·å­˜å‚¨æ ¼å¼
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const gameforgeUsers = JSON.parse(localStorage.getItem('gameforge_users') || '[]');
                
                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                if (!users.find(u => u.username === 'testuser')) {
                    users.push(testUser);
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                if (!gameforgeUsers.find(u => u.username === 'testuser')) {
                    gameforgeUsers.push({
                        username: 'testuser',
                        email: 'test@example.com',
                        password: '123456',
                        isDeveloper: false,
                        joinDate: new Date().toISOString(),
                        downloadedGames: [1, 2, 3],
                        uploadedGames: []
                    });
                    localStorage.setItem('gameforge_users', JSON.stringify(gameforgeUsers));
                }
                
                // è®¾ç½®ç™»å½•çŠ¶æ€
                localStorage.setItem('currentUser', JSON.stringify(testUser));
                localStorage.setItem('gameforge_logged_in_user', 'testuser');
                
                result.innerHTML = 'âœ… æµ‹è¯•ç”¨æˆ·åˆ›å»ºæˆåŠŸï¼ç”¨æˆ·å: testuser, å¯†ç : 123456';
                result.className = 'result success';
                
            } catch (error) {
                result.innerHTML = 'åˆ›å»ºå¤±è´¥: ' + error.message;
                result.className = 'result error';
            }
        }
        
        // æ¸…é™¤æµ‹è¯•æ•°æ®çš„å‡½æ•°
        function clearTestData() {
            const result = document.getElementById('create-result');
            
            // åªæ¸…é™¤æµ‹è¯•ç›¸å…³æ•°æ®
            localStorage.removeItem('currentUser');
            localStorage.removeItem('gameforge_logged_in_user');
            
            // æ¸…é™¤æµ‹è¯•ç”¨æˆ·
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const filteredUsers = users.filter(u => u.username !== 'testuser');
            localStorage.setItem('users', JSON.stringify(filteredUsers));
            
            const gameforgeUsers = JSON.parse(localStorage.getItem('gameforge_users') || '[]');
            const filteredGameforgeUsers = gameforgeUsers.filter(u => u.username !== 'testuser');
            localStorage.setItem('gameforge_users', JSON.stringify(filteredGameforgeUsers));
            
            result.innerHTML = 'âœ… æµ‹è¯•æ•°æ®å·²æ¸…é™¤';
            result.className = 'result success';
        }
        
        // æµ‹è¯•ç™»å½•çŠ¶æ€æ£€æŸ¥çš„å‡½æ•°
        function testLoginStatus() {
            const result = document.getElementById('login-result');
            try {
                const loggedInUser = localStorage.getItem('gameforge_logged_in_user');
                const gameforgeUsers = JSON.parse(localStorage.getItem('gameforge_users') || '[]');
                
                if (loggedInUser) {
                    const user = gameforgeUsers.find(u => u.username === loggedInUser);
                    if (user) {
                        result.innerHTML = `âœ… ç™»å½•çŠ¶æ€æ­£å¸¸<br>ç”¨æˆ·: ${user.username}<br>é‚®ç®±: ${user.email}`;
                        result.className = 'result success';
                    } else {
                        result.innerHTML = `âŒ ç™»å½•ç”¨æˆ· ${loggedInUser} ä¸å­˜åœ¨äºç”¨æˆ·åˆ—è¡¨ä¸­`;
                        result.className = 'result error';
                    }
                } else {
                    result.innerHTML = 'âŒ æœªæ£€æµ‹åˆ°ç™»å½•çŠ¶æ€ï¼Œè¯·å…ˆç™»å½•';
                    result.className = 'result error';
                }
            } catch (error) {
                result.innerHTML = 'æ£€æŸ¥å‡ºé”™: ' + error.message;
                result.className = 'result error';
            }
        }
        
        // æµ‹è¯•é€€å‡ºç™»å½•çš„å‡½æ•°
        function testLogout() {
            const result = document.getElementById('logout-result');
            
            // æ¨¡æ‹Ÿé€€å‡ºç™»å½•
            localStorage.removeItem('currentUser');
            localStorage.removeItem('gameforge_logged_in_user');
            
            // æ£€æŸ¥é€€å‡ºç»“æœ
            const currentUser = localStorage.getItem('currentUser');
            const loggedInUser = localStorage.getItem('gameforge_logged_in_user');
            
            if (!currentUser && !loggedInUser) {
                result.innerHTML = 'âœ… é€€å‡ºç™»å½•æˆåŠŸï¼æ‰€æœ‰ç™»å½•æ•°æ®å·²æ¸…é™¤';
                result.className = 'result success';
            } else {
                result.innerHTML = 'âŒ é€€å‡ºç™»å½•å¤±è´¥ï¼Œä»æœ‰æ•°æ®æ®‹ç•™';
                result.className = 'result error';
            }
            
            // é‡æ–°æ£€æŸ¥å­˜å‚¨çŠ¶æ€
            setTimeout(checkStorage, 1000);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            checkStorage();
        });
    </script>
</body>
</html>